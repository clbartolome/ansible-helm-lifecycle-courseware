<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>First Execution :: Ansible Helm Lifecycle Guide</title>
    <link rel="canonical" href="https://clbartolome.github.io/ansible-helm-lifecycle-guide/ansible-helm-lifecycle/02-first_execution.html">
    <link rel="prev" href="01-overview.html">
    <link rel="next" href="03-testing_environment.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://clbartolome.github.io/ansible-helm-lifecycle-guide">Ansible Helm Lifecycle Guide</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ansible-helm-lifecycle" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Welcome</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-overview.html">1. Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#gitea">Gitea</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#aap">Ansible Automation Platform</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#ocp">OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#nexus">Nexus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#argo">Argo CD</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-first_execution.html">2. First Execution</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#webhook">Configure Webhook</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#nexus">Configure Nexus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#chart">Update Chart Repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#validate">Validate Execution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#app">Update Application</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-testing_environment.html">3. Testing Environment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-testing_environment.html#create-ns">Create Namespace</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-testing_environment.html#install-chart">Install Chart</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-testing_environment.html#uninstall-chart">uninstall Chart</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-testing_environment.html#delete-ns">Delete Namespace</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-validations.html">4. Validations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-validations.html#replicas">Replicas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-validations.html#route">Route</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-validations.html#size">Size</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-notification.html">5. Notifications</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-notification.html#config">User Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-notification.html#task">Task</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-challenges.html">6. Challenges</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-challenges.html#validations">Aditional Validations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-challenges.html#scenarios">Multiple Scenarios</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-challenges.html#sizes">New Sizes</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Ansible Helm Lifecycle Guide</a></li>
    <li><a href="02-first_execution.html">2. First Execution</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/clbartolome/ansible-helm-lifecycle-guide/edit/master/documentation/modules/ROOT/pages/02-first_execution.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">First Execution</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
During this laboratory exercises you will see <strong>&lt;student&gt;</strong> in some files and URLs, remember to update it with your assigned <strong>student id</strong>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="webhook"><a class="anchor" href="#webhook"></a>Configure Webhook</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have created a Helm Chart named <strong>base-chart</strong> that will help Operation Teams with cluster management and also will help Application Teams with application deployments. In order to make upgrades or fix issues in our <strong>base-chart</strong> we are going to create a pipeline that manages the Helm Chart lifecycle.</p>
</div>
<div class="paragraph">
<p>The first step is creating a webhook in our <strong>AAP Workflow</strong> (pipeline) and configure it in <strong>Gitea base-chart</strong> repository so we can trigger it when new features or fixes are commited in our repository.</p>
</div>
<div class="sect2">
<h3 id="_create_webhook"><a class="anchor" href="#_create_webhook"></a>Create Webhook</h3>
<div class="ulist">
<ul>
<li>
<p>Login into <strong>Ansible Automation Platform</strong> and go to: <strong>Resources</strong> &gt; <strong>Templates</strong> &gt; <strong>[WF] Base Chart Pipeline</strong> and click <strong>edit</strong>.</p>
</li>
<li>
<p>Enable the option <strong>Enable Webhook</strong>.</p>
</li>
<li>
<p>Under <strong>Webhook details</strong> select <strong>GitHub</strong> as <strong>Webhook Service</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> to generate the <strong>Webhook Key</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-webhook.png" alt="2 first webhook">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Copy the <strong>Webhook Key</strong> and the <strong>Webhook URL</strong>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configure_webhook_in_gitea"><a class="anchor" href="#_configure_webhook_in_gitea"></a>Configure Webhook in Gitea</h3>
<div class="ulist">
<ul>
<li>
<p>Login into <strong>Gitea</strong> and open <strong>base-chart</strong> repository.</p>
</li>
<li>
<p>Go to <strong>Settings</strong> (top right corner) &gt; <strong>Webhook</strong> &gt; <strong>Add Webhook</strong> &gt; <strong>Gitea</strong>.</p>
</li>
<li>
<p>Configure the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Target URL</strong>: Copy the <strong>Webhook URL</strong> from AAP.</p>
</li>
<li>
<p><strong>Secret</strong>: Copy the <strong>Webhook Key</strong> from AAP.</p>
</li>
<li>
<p>Keep the rest of settings by default.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Add Webhook</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-giteawh.png" alt="2 first giteawh">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="nexus"><a class="anchor" href="#nexus"></a>Configure Nexus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nexus is going to be the repository where we&#8217;re going to upload our packaged <strong>base-chart</strong>. In order to be able to upload it automatically as part of our pipeline, we need to modify the playbook where the chart is packaged and uploaded to point to your student repository in Nexus.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login into <strong>Gitea</strong> and open <strong>helm-ansible-pipeline</strong> repository.</p>
</li>
<li>
<p>Open the playbook <strong>05-helm-package-nexus.yml</strong>.</p>
</li>
<li>
<p>Replace all <strong>&lt;student&gt;</strong> ocurrences with your student id.</p>
</li>
<li>
<p>Click <strong>Commit Changes</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-nexus-playbook.png" alt="2 first nexus playbook">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chart"><a class="anchor" href="#chart"></a>Update Chart Repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now it is time to trigger our <strong>AAP Workflow</strong>. To do so we&#8217;re going to make a change in our <strong>base-chart</strong> repository and that change will automatically trigger the pipeline.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login into <strong>Gitea</strong> and open <strong>base-chart</strong> repository.</p>
</li>
<li>
<p>Open the file <strong>chart/Chart.yaml</strong>.</p>
</li>
<li>
<p>Modify <strong>version</strong> to <strong>1.0.0</strong>.</p>
</li>
<li>
<p>Click <strong>Commit Changes</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-basechart.png" alt="2 first basechart">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validate"><a class="anchor" href="#validate"></a>Validate Execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pipeline should be now running in <strong>AAP</strong> and the new version of <strong>base-chart</strong> should be in your student repository in Nexus, let&#8217;s take a look at it.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login into <strong>Ansible Automation Platform</strong> and go to: <strong>Views</strong> &gt; <strong>Jobs</strong> &gt; <strong>[WF] Base Chart Pipeline</strong> (last execution):</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-aap-wf.png" alt="2 first aap wf">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Access the <strong>Workflow</strong> to review the execution, all <strong>JobTemplates</strong> should have a green check:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-wf-view.png" alt="2 first wf view">
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s login into <strong>Nexus</strong> &gt; <strong>Browse</strong> &gt; <strong>&lt;student&gt;</strong> to validate that the new version of your <strong>base-chart</strong> has been uploaded.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-nx-chart.png" alt="2 first nx chart">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app"><a class="anchor" href="#app"></a>Update Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Currently your <strong>demo-app</strong> deployment in <strong>ArgoCD</strong> is pointing to an initial version named <strong>base-chart-0.0.1</strong>. In order to update it and use the new version that we&#8217;ve just created, we need to update the deployment files in <strong>ArgoCD</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login into <strong>Gitea</strong> and open <strong>demo-app</strong> repository.</p>
</li>
<li>
<p>Open the file <strong>deploy/Chart.yaml</strong> and update:</p>
<div class="ulist">
<ul>
<li>
<p>Repository: change <strong>/helm</strong> with your student id.</p>
</li>
<li>
<p>Version: update to <strong>1.0.0</strong>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example (<mark>replace &lt;student&gt; with your student id</mark>):</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">apiVersion: v2
name: demo-app
description: Demo App
type: application
version: 1.0
appVersion: "1.0.0"
dependencies:
- name: base-chart
  repository: <a href="http://nexus.apps.cluster-wmbjp.wmbjp.sandbox2100.opentlc.com/repository/&lt;student&gt;/" class="bare">http://nexus.apps.cluster-wmbjp.wmbjp.sandbox2100.opentlc.com/repository/&lt;student&gt;/</a>
  version: 1.0.0</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Commit your changes.</p>
</li>
<li>
<p>Login into <strong>ArgoCD</strong> and open your <strong>demo-app</strong> application. <strong>ArgoCD</strong> automatically syncs each 3 minutes but we can manually force <strong>ArgoCD</strong> synchronization by pressing the <strong>SYNC</strong> button (use the default synchronization values). Now you should see your changes applied in the section <strong>LAST SYNC RESULT</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-argo.png" alt="2 first argo">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Login into OpenShift and go to <strong>Topology</strong> and select your <strong>&lt;student&gt;-demo-app</strong> namespace.</p>
</li>
<li>
<p>Open your <strong>deployment</strong> clicking on the <strong>NGINX</strong> icon:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-ocp-ov.png" alt="2 first ocp ov">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <strong>URL</strong> button to open your application, the chart version should be <strong>base-chart-1.0.0</strong>:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-demo-app.png" alt="2 first demo app">
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
your web browser could be caching previous version. Use <strong>Ctrl + F5</strong> or <strong>Cmd-Shift-R</strong> on MacOS to refresh your cache.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>demo-app-xxx</strong> pod link to review pod details and validate the pod have a label <strong>helm.sh/chart:base-chart-1.0.0</strong>:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/2-first-pod-labels.png" alt="2 first pod labels">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Review the other labels added by the <strong>base-chart</strong> to help on cluster housekeeping tasks.
</td>
</tr>
</table>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="01-overview.html">1. Overview</a></span>
  <span class="next"><a href="03-testing_environment.html">3. Testing Environment</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
