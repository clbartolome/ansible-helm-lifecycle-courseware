<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Validations :: Ansible Helm Lifecycle Guide</title>
    <link rel="canonical" href="https://clbartolome.github.io/ansible-helm-lifecycle-guide/ansible-helm-lifecycle/04-validations.html">
    <link rel="prev" href="03-testing_environment.html">
    <link rel="next" href="05-notification.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://clbartolome.github.io/ansible-helm-lifecycle-guide">Ansible Helm Lifecycle Guide</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ansible-helm-lifecycle" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Welcome</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-overview.html">1. Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#gitea">Gitea</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#aap">Ansible Automation Platform</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#ocp">OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#nexus">Nexus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#argo">Argo CD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-first_execution.html">2. First Execution</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-first_execution.html#webhook">Configure Webhook</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-first_execution.html#nexus">Configure Nexus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-first_execution.html#chart">Update Chart Repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-first_execution.html#validate">Validate Execution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-first_execution.html#app">Update Application</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-testing_environment.html">3. Testing Environment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-testing_environment.html#create-ns">Create Namespace</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-testing_environment.html#install-chart">Install Chart</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-testing_environment.html#uninstall-chart">uninstall Chart</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-testing_environment.html#delete-ns">Delete Namespace</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-validations.html">4. Validations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#replicas">Replicas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#route">Route</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#size">Size</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-notification.html">5. Notifications</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-notification.html#config">User Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-notification.html#task">Task</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-challenges.html">6. Challenges</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-challenges.html#errors">Error Handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-challenges.html#scenarios">Multiple Scenarios</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-challenges.html#sizes">New Sizes</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Ansible Helm Lifecycle Guide</a></li>
    <li><a href="04-validations.html">4. Validations</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/clbartolome/ansible-helm-lifecycle-guide/edit/master/documentation/modules/ROOT/pages/04-validations.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Validations</h1>
<div class="sect1">
<h2 id="replicas"><a class="anchor" href="#replicas"></a>Replicas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO: Content</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="route"><a class="anchor" href="#route"></a>Route</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO: Content</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="size"><a class="anchor" href="#size"></a>Size</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO: Content</p>
</div>
<div class="listingblock">
<div class="content">
<pre>      - name: Clone Base Chart remote repository
          ansible.builtin.git:
            repo: http://gitea.app-lifecycle-demo.svc:3000/gitea/base-chart.git
            dest: /tmp/base-chart
            version: master

        - name: Read scenario values
          ansible.builtin.include_vars:
            file: "/tmp/base-chart/test/scenario1/values.yaml"
            name: scenario

        ########################################################################
        # Deployment Tests
        ########################################################################

        - name: Test - Deployment --&gt; Get deployment
          kubernetes.core.k8s_info:
            api_version: apps/v1
            kind: Deployment
            namespace: "&lt;student&gt;-base-chart"
            label_selectors:
              - app={{ helm_test_scenario }}
          ignore_errors: true
          register: scenario_deployment

        - name: Test - Deployment --&gt; Validate the number of replicas is correct
          ansible.builtin.set_fact:
            failed: true
          when: scenario_deployment.resources[0].spec.replicas != scenario.deploy.replicas

        - name: DEPLOY
          debug:
            var: scenario_deployment

        - name: Test - Application Size - S or default
          ansible.builtin.set_fact:
            failed: true
          when: (scenario.size is undefined or scenario.size == "S") and not
                (scenario_deployment.resources[0].spec.template.spec.containers[0].resources.limits.cpu == "100m" and
                scenario_deployment.resources[0].spec.template.spec.containers[0].resources.limits.memory == "256Mi" and
                scenario_deployment.resources[0].spec.template.spec.containers[0].resources.requests.cpu == "100m" and
                scenario_deployment.resources[0].spec.template.spec.containers[0].resources.requests.memory == "256Mi")

        ########################################################################
        # Route Tests
        ########################################################################

        - name: Test - Route --&gt; Get route
          kubernetes.core.k8s_info:
            api_version: route.openshift.io/v1
            kind: Route
            namespace: "&lt;student&gt;-base-chart"
            label_selectors:
              - app=scenario1
          register: scenario_route
          ignore_errors: true

        - name: Test - Route --&gt; Send request to the route when route is defined and enabled
          ansible.builtin.uri:
            url: "http://{{ scenario_route.resources[0].spec.host }}"
            method: GET
            status_code: 200
            return_content: yes
          ignore_errors: true
          register: route_response
          when: scenario.deploy.route is defined and scenario.deploy.route.enabled == true and scenario_route.resources | length &gt; 0

        - name: Test - Route --&gt; Validate route is working when is defined and enabled
          ansible.builtin.set_fact:
            failed: true
          when: scenario.deploy.route is defined and scenario.deploy.route.enabled == true and scenario_route.resources | length &gt; 0 and route_response.status != 200</pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="03-testing_environment.html">3. Testing Environment</a></span>
  <span class="next"><a href="05-notification.html">5. Notifications</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
